<% if flash[:success].present? %>
  <% flash.discard %>

  <%# Hide the errors div%>
  $('div.message.error').addClass('hide');

  <%# Add a new table row%>
  $('#wishlist').append("<%= escape_javascript(render :partial => 'wishlist_row', :object => @wishlist) %>")
  $('#wishlist_<%= @wishlist.id %>').effect('highlight', {}, 1000);

  <%
  # Re-apply the table sorting
  # TODO: Is this necessary? It throws errors when you're adding your first wishlist entry.
  # page << "sortWishlistTable();"
  %>

  <%# Reset the inline form and focus the name field%>
  JuggLF.wishlist_form.clear();
<% elsif flash[:error].present? %>
  <% flash.discard %>

  <%# Show the errors div%>
  $('div.message.error').removeClass('hide');

  <%# Add the error messages%>
  $('div.message.error').html("<%= escape_javascript(render :partial => "shared/form_errors", :object => @wishlist) %>")

  <%# Focus the name field%>
  $('#wishlist_item_name').focus();
<% end %>
